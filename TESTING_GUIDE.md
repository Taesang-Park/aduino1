# 물 섭취량 모니터링 시스템 - 작동 테스트 가이드

**문서 버전**: 1.0
**작성일**: 2025-01-08
**대상**: 처음 시스템을 실행하는 사용자

---

## 📋 목차

1. [사전 준비사항](#1-사전-준비사항)
2. [Step 1: 하드웨어 조립 및 연결](#step-1-하드웨어-조립-및-연결)
3. [Step 2: 아두이노 코드 업로드](#step-2-아두이노-코드-업로드)
4. [Step 3: 아두이노 단독 테스트](#step-3-아두이노-단독-테스트)
5. [Step 4: 블루투스 연결 테스트](#step-4-블루투스-연결-테스트)
6. [Step 5: 안드로이드 앱 빌드](#step-5-안드로이드-앱-빌드)
7. [Step 6: 앱 설치 및 권한 설정](#step-6-앱-설치-및-권한-설정)
8. [Step 7: 통합 테스트](#step-7-통합-테스트)
9. [Step 8: 실제 사용 시나리오 테스트](#step-8-실제-사용-시나리오-테스트)
10. [문제 해결](#문제-해결)
11. [최종 체크리스트](#최종-체크리스트)

---

## 1. 사전 준비사항

### 1.1 필요한 하드웨어 ✅

| 부품 | 수량 | 확인 |
|-----|------|------|
| Arduino Uno | 1개 | ☐ |
| 로드셀 (5kg 또는 10kg) | 1개 | ☐ |
| HX711 모듈 | 1개 | ☐ |
| HC-05 또는 HC-06 블루투스 모듈 | 1개 | ☐ |
| 점퍼 와이어 (M-M) | 10개 이상 | ☐ |
| 브레드보드 | 1개 | ☐ |
| USB 케이블 (A to B) | 1개 | ☐ |
| 저항 (1kΩ, 2kΩ) | 각 1개 | ☐ |
| 컵 (테스트용) | 1개 | ☐ |

### 1.2 필요한 소프트웨어 ✅

| 소프트웨어 | 버전 | 설치 확인 | 다운로드 링크 |
|-----------|------|-----------|--------------|
| Arduino IDE | 2.x | ☐ | https://www.arduino.cc/en/software |
| Android Studio | 2023.1.1+ | ☐ | https://developer.android.com/studio |
| HX711 라이브러리 | Latest | ☐ | Arduino Library Manager |
| Android 기기 또는 에뮬레이터 | Android 7.0+ | ☐ | - |

### 1.3 사전 지식 확인 ✅

- ☐ Arduino IDE 사용법 기본 이해
- ☐ 브레드보드 연결 방법 이해
- ☐ Android Studio 기본 사용법
- ☐ 블루투스 페어링 방법

---

## Step 1: 하드웨어 조립 및 연결

### 1.1 로드셀 → HX711 연결

**로드셀의 4개 선 연결:**

```
로드셀 선 색상 → HX711 핀
─────────────────────────
RED (E+)     → E+
BLACK (E-)   → E-
WHITE (A-)   → A-
GREEN (A+)   → A+
```

**체크포인트:**
- ☐ 선이 단단히 연결되었는가?
- ☐ 색상 순서가 정확한가?

> ⚠️ **주의**: 로드셀 제조사에 따라 선 색상이 다를 수 있습니다. 제품 설명서를 확인하세요.

### 1.2 HX711 → Arduino 연결

**연결표:**

| HX711 핀 | Arduino 핀 | 점퍼 와이어 색상 (권장) |
|---------|-----------|-------------------|
| VCC     | 5V        | 빨강 |
| GND     | GND       | 검정 |
| DT      | Pin 3     | 노랑 |
| SCK     | Pin 2     | 초록 |

**연결 순서:**
1. Arduino의 전원을 **끈** 상태에서 연결
2. VCC (빨강) 연결
3. GND (검정) 연결
4. DT (노랑) 연결
5. SCK (초록) 연결

**체크포인트:**
- ☐ 모든 연결이 견고한가?
- ☐ VCC와 GND가 바뀌지 않았는가?
- ☐ 핀 번호가 정확한가?

### 1.3 HC-05/06 → Arduino 연결

**전압 분배기 회로 (필수!):**

HC-05/06의 RXD는 3.3V이므로, Arduino의 5V TX를 직접 연결하면 손상될 수 있습니다.

```
Arduino Pin 11 (TX)
        |
      [1kΩ 저항]
        |
        +-------- HC-05/06 RXD
        |
      [2kΩ 저항]
        |
       GND
```

**연결표 (전압 분배기 적용):**

| HC-05/06 핀 | Arduino 핀 | 비고 |
|------------|-----------|------|
| VCC        | 5V (또는 3.3V) | 모듈 사양 확인 |
| GND        | GND       | 공통 접지 |
| TXD        | Pin 10 (RX) | 직접 연결 OK |
| RXD        | Pin 11 (TX) | **전압 분배기 사용** |

**연결 순서:**
1. 브레드보드에 전압 분배기 회로 구성
2. GND 연결
3. VCC 연결 (모듈 LED가 깜빡이는지 확인)
4. TXD → Arduino Pin 10
5. RXD → 전압 분배기 연결

**체크포인트:**
- ☐ 전압 분배기를 올바르게 구성했는가?
- ☐ HC-05/06의 LED가 깜빡이는가?
- ☐ TX와 RX가 교차 연결되었는가?

### 1.4 최종 연결 확인

**전체 연결도:**

```
로드셀
  |
HX711 ─── (VCC, GND, DT, SCK) ─── Arduino Uno ─── (5V, GND, TX, RX) ─── HC-05/06
  |                                      |
  |                                    USB 케이블
  |                                      |
측정 대상                              컴퓨터
```

**전원 확인:**
1. USB 케이블을 컴퓨터에 연결
2. Arduino LED가 켜지는가? ☐
3. HC-05/06 LED가 깜빡이는가? ☐
4. 이상한 냄새나 뜨거워지는 부품이 없는가? ☐

> 🔥 **비상 상황**: 이상한 냄새가 나거나 부품이 뜨거워지면 즉시 USB를 뽑으세요!

---

## Step 2: 아두이노 코드 업로드

### 2.1 Arduino IDE 설정

**2.1.1 Arduino IDE 실행**
```bash
1. Arduino IDE 실행
2. File → Preferences 확인
```

**2.1.2 보드 설정**
```bash
Tools → Board → Arduino AVR Boards → Arduino Uno
```
- ☐ Arduino Uno 선택됨

**2.1.3 포트 설정**
```bash
Tools → Port → COM3 (또는 사용 가능한 포트)
```
- ☐ 올바른 COM 포트 선택됨
- ℹ️ 포트 번호는 컴퓨터마다 다릅니다

> 💡 **팁**: 포트를 모르겠으면 Arduino를 뺐다가 다시 꽂아보세요. 새로 나타나는 포트가 Arduino입니다.

### 2.2 HX711 라이브러리 설치

**방법 1: Library Manager 사용 (권장)**

```bash
1. Sketch → Include Library → Manage Libraries...
2. 검색창에 "HX711" 입력
3. "HX711 Arduino Library" by Bogdan Necula 선택
4. "Install" 버튼 클릭
5. 설치 완료 대기
```

**확인:**
- ☐ "Installed" 표시 확인
- ☐ 버전 확인 (0.7.5 이상 권장)

**방법 2: 수동 설치 (Library Manager 실패 시)**

```bash
1. https://github.com/bogde/HX711 접속
2. Code → Download ZIP
3. Sketch → Include Library → Add .ZIP Library...
4. 다운로드한 ZIP 파일 선택
```

### 2.3 프로젝트 파일 열기

**파일 경로:**
```
C:\Users\HP\Documents\programming\aduino1\arduino\water_monitor.ino
```

**Arduino IDE에서 열기:**
```bash
1. File → Open...
2. water_monitor.ino 파일 찾기
3. 열기
```

**확인사항:**
- ☐ `water_monitor` 탭이 열렸는가?
- ☐ `config.h` 탭도 함께 열렸는가?

### 2.4 설정 확인 및 수정

**config.h 파일 열기:**

Arduino IDE에서 `config.h` 탭 클릭

**중요 설정 확인:**

```cpp
// 1. 핀 설정 확인
#define HX711_DOUT_PIN  3  // ✓ 연결한 핀과 일치하는지 확인
#define HX711_SCK_PIN   2  // ✓
#define BT_RX_PIN  10      // ✓
#define BT_TX_PIN  11      // ✓

// 2. 디버그 모드 활성화 (첫 테스트 시)
#define DEBUG_MODE  true   // ✓ true로 설정

// 3. 캘리브레이션 인자 (일단 기본값 사용)
#define CALIBRATION_FACTOR  -7050.0  // 나중에 조정
```

**체크포인트:**
- ☐ 핀 번호가 실제 연결과 일치하는가?
- ☐ DEBUG_MODE가 true인가?

### 2.5 컴파일 및 업로드

**컴파일:**

```bash
1. Sketch → Verify/Compile (Ctrl+R)
2. 하단에 "Done compiling" 메시지 확인
3. 에러가 없는지 확인
```

**예상 출력:**
```
Sketch uses XXXX bytes (XX%) of program storage space.
Global variables use XXX bytes (XX%) of dynamic memory.
```

**체크포인트:**
- ☐ 컴파일 성공 (Done compiling)
- ☐ 에러 메시지 없음

**업로드:**

```bash
1. Sketch → Upload (Ctrl+U)
2. "Uploading..." 메시지 확인
3. Arduino의 TX/RX LED가 깜빡임
4. "Done uploading" 메시지 대기
```

**예상 출력:**
```
avrdude: XXX bytes of flash verified
avrdude done. Thank you.
```

**체크포인트:**
- ☐ 업로드 성공 (Done uploading)
- ☐ 에러 메시지 없음

> ⚠️ **업로드 실패 시**:
> - 올바른 보드/포트 선택 확인
> - USB 케이블 재연결
> - Arduino IDE 재시작

---

## Step 3: 아두이노 단독 테스트

### 3.1 시리얼 모니터 열기

**시리얼 모니터 실행:**

```bash
1. Tools → Serial Monitor (Ctrl+Shift+M)
2. 우측 하단 Baud Rate를 "9600" 선택
3. "Both NL & CR" 선택
```

**체크포인트:**
- ☐ 시리얼 모니터 창이 열렸는가?
- ☐ Baud rate가 9600인가?

### 3.2 초기화 메시지 확인

**예상 출력:**

```
=== Water Monitor System ===
Initializing...
Initializing HX711...
Taring... Please remove all weight.
HX711 ready!
Initializing Bluetooth...
Bluetooth ready!
System ready!
```

**체크포인트:**
- ☐ 모든 초기화 메시지가 표시되는가?
- ☐ "ERROR: HX711 not found!" 메시지가 없는가?
- ☐ "System ready!" 메시지가 나타나는가?

> ❌ **에러 발생 시**: [문제 해결 - HX711 오류](#hx711-오류) 참조

### 3.3 무게 측정 테스트

**테스트 1: 빈 로드셀**

```
동작: 로드셀 위에 아무것도 올리지 않음
예상 출력:
Weight: 0.00
Weight: 0.50
Weight: -0.30
Weight: 0.10
```

**체크포인트:**
- ☐ Weight 값이 출력되는가?
- ☐ 값이 대략 0 근처인가? (±10g 이내)

**테스트 2: 알려진 무게 올리기**

```
동작: 정확히 알고 있는 무게(예: 100g) 올리기
예상 출력:
Weight: 142.30
Weight: 141.80
Weight: 142.50
```

**기록:**
- 실제 무게: _________ g
- 표시된 값: _________ (평균)
- 오차: _________ g

> 📝 **중요**: 이 값은 나중에 캘리브레이션에 사용됩니다!

### 3.4 블루투스 데이터 전송 확인

**시리얼 모니터에서 확인:**

```
예상 출력 (컵을 올렸을 때):
Cup detected!
W:253.5
W:253.2
W:253.8
```

**체크포인트:**
- ☐ "Cup detected!" 메시지가 나타나는가?
- ☐ "W:XXX" 형식의 데이터가 전송되는가?

**테스트 3: 무게 감소 감지**

```
동작:
1. 물이 담긴 컵을 올림 (예: 300g)
2. 물을 조금 마심 (예: 50g)
3. 컵을 다시 올림 (250g)

예상 출력:
Weight: 300.5
Weight: 299.8
(물을 마심)
Weight: 250.2
Weight: 249.8
Drink detected: 50.0
D:50.0
```

**체크포인트:**
- ☐ "Drink detected" 메시지가 나타나는가?
- ☐ "D:XXX" 형식의 데이터가 전송되는가?
- ☐ 마신 양이 대략 정확한가?

### 3.5 명령 테스트

**Tare 명령 테스트:**

```bash
시리얼 모니터 입력창에 "T" 입력 후 Enter
```

**예상 출력:**
```
Received command: T
Taring scale...
Tare complete!
```

**체크포인트:**
- ☐ 명령이 인식되는가?
- ☐ 영점 조정이 실행되는가?
- ☐ Weight 값이 0으로 리셋되는가?

**Reset 명령 테스트:**

```bash
시리얼 모니터 입력창에 "R" 입력 후 Enter
```

**예상 출력:**
```
Received command: R
Resetting system...
Reset complete!
```

**체크포인트:**
- ☐ 리셋이 실행되는가?
- ☐ 모든 변수가 초기화되는가?

### 3.6 아두이노 단독 테스트 결과

**전체 체크:**
- ☐ HX711 초기화 성공
- ☐ 무게 측정 가능
- ☐ 블루투스 데이터 전송 확인
- ☐ 무게 변화 감지 작동
- ☐ 명령 처리 작동

**✅ 모든 항목 체크 시**: Step 4로 진행
**❌ 실패 항목 있을 시**: [문제 해결](#문제-해결) 참조

---

## Step 4: 블루투스 연결 테스트

### 4.1 블루투스 터미널 앱 설치 (Android)

**권장 앱:**
- Serial Bluetooth Terminal (Google Play)
- Bluetooth Terminal HC-05 (Google Play)

**설치:**
```bash
1. Google Play Store 열기
2. "Serial Bluetooth Terminal" 검색
3. 설치
```

### 4.2 HC-05/06 페어링

**페어링 절차:**

```bash
1. 휴대폰 설정 → 블루투스 열기
2. "사용 가능한 기기" 목록에서 HC-05 또는 HC-06 찾기
3. 탭하여 페어링 시작
4. PIN 입력: 1234 또는 0000
5. "연결됨" 상태 확인
```

**체크포인트:**
- ☐ HC-05/06이 검색되는가?
- ☐ 페어링 성공했는가?
- ☐ "연결됨" 상태인가?

> 💡 **찾을 수 없을 때**: HC-05/06의 이름은 "HC-05", "HC-06", "BT-Module" 등일 수 있습니다.

### 4.3 블루투스 터미널 연결

**Serial Bluetooth Terminal 앱 사용:**

```bash
1. 앱 실행
2. 좌측 상단 메뉴 → Devices
3. "Bluetooth Classic" 탭 선택
4. 페어링된 HC-05/06 선택
5. "연결됨" 상태 확인
```

**체크포인트:**
- ☐ 디바이스에 연결되는가?
- ☐ 연결 상태 표시가 나타나는가?

### 4.4 데이터 수신 테스트

**앱에서 데이터 확인:**

```
예상 출력:
S:READY
W:0.5
W:0.2
W:0.8
(컵을 올림)
S:CUP_ON
W:253.5
W:253.2
```

**체크포인트:**
- ☐ 데이터가 실시간으로 수신되는가?
- ☐ "W:", "S:" 형식이 올바른가?
- ☐ 무게 값이 변하는가?

### 4.5 명령 전송 테스트

**Tare 명령 전송:**

```bash
1. 앱 하단 입력창에 "T" 입력
2. Send 버튼 클릭
```

**예상 수신:**
```
S:TARING
S:TARE_OK
```

**체크포인트:**
- ☐ 명령이 전송되는가?
- ☐ 응답이 수신되는가?
- ☐ 영점 조정이 실행되는가?

### 4.6 블루투스 테스트 결과

**전체 체크:**
- ☐ 페어링 성공
- ☐ 터미널 연결 성공
- ☐ 데이터 수신 확인
- ☐ 명령 전송 확인
- ☐ 양방향 통신 작동

**✅ 모든 항목 체크 시**: Step 5로 진행
**❌ 실패 항목 있을 시**: [문제 해결 - 블루투스](#블루투스-연결-오류) 참조

---

## Step 5: 안드로이드 앱 빌드

### 5.1 Android Studio 프로젝트 열기

**프로젝트 경로:**
```
C:\Users\HP\Documents\programming\aduino1
```

**Android Studio 실행:**

```bash
1. Android Studio 실행
2. "Open" 클릭
3. 위 경로 선택
4. "OK" 클릭
5. 프로젝트 로드 대기 (1-5분)
```

**체크포인트:**
- ☐ 프로젝트가 열렸는가?
- ☐ Gradle sync가 자동으로 실행되는가?

### 5.2 Gradle Sync

**자동 Sync:**

프로젝트를 처음 열면 자동으로 Gradle Sync가 실행됩니다.

**우측 하단 확인:**
```
Gradle Sync: Downloading dependencies...
```

**예상 소요 시간**: 3-10분 (인터넷 속도에 따라)

**수동 Sync (필요시):**

```bash
File → Sync Project with Gradle Files
```

**성공 메시지:**
```
BUILD SUCCESSFUL in XXs
```

**체크포인트:**
- ☐ Gradle Sync 완료
- ☐ 에러 메시지 없음
- ☐ "BUILD SUCCESSFUL" 표시

> ⚠️ **Gradle Sync 실패 시**:
> - 인터넷 연결 확인
> - Android Studio 재시작
> - Gradle 캐시 삭제: File → Invalidate Caches / Restart

### 5.3 프로젝트 구조 확인

**Project 뷰에서 확인:**

```
app/
├── src/
│   ├── main/
│   │   ├── java/com/example/aduino1/
│   │   │   ├── MainActivity.kt ✓
│   │   │   ├── data/ ✓
│   │   │   ├── domain/ ✓
│   │   │   ├── presentation/ ✓
│   │   │   └── ui/ ✓
│   │   ├── AndroidManifest.xml ✓
│   │   └── res/ ✓
│   └── ...
├── build.gradle.kts ✓
└── ...
```

**체크포인트:**
- ☐ 모든 파일이 존재하는가?
- ☐ 빨간색 에러 표시가 없는가?

### 5.4 빌드 설정 확인

**Build Variant 확인:**

```bash
1. View → Tool Windows → Build Variants
2. "debug" 선택되어 있는지 확인
```

**체크포인트:**
- ☐ Build Variant가 "debug"인가?

### 5.5 앱 빌드

**빌드 실행:**

```bash
Build → Make Project (Ctrl+F9)
```

**빌드 진행:**
```
Building...
Executing tasks: [:app:compileDebugKotlin]
...
BUILD SUCCESSFUL in XXs
```

**예상 소요 시간**: 2-5분 (첫 빌드 시)

**체크포인트:**
- ☐ 빌드 성공 (BUILD SUCCESSFUL)
- ☐ 에러 메시지 없음

**Build Output 확인:**
```
> Task :app:compileDebugKotlin
> Task :app:compileDebugJavaWithJavac
> Task :app:mergeDebugResources
...
BUILD SUCCESSFUL in 2m 34s
XX actionable tasks: XX executed
```

### 5.6 APK 생성 (선택사항)

**APK 빌드:**

```bash
Build → Build Bundle(s) / APK(s) → Build APK(s)
```

**성공 메시지:**
```
APK(s) generated successfully
```

**APK 위치:**
```
app/build/outputs/apk/debug/app-debug.apk
```

**체크포인트:**
- ☐ APK 생성 완료
- ☐ "Locate" 버튼으로 파일 확인 가능

---

## Step 6: 앱 설치 및 권한 설정

### 6.1 Android 기기 연결

**방법 1: 실제 Android 기기**

**USB 디버깅 활성화:**

```bash
1. 휴대폰 설정 → 휴대전화 정보
2. "빌드 번호"를 7번 연속 탭
3. "개발자 옵션이 활성화되었습니다" 메시지 확인
4. 설정 → 개발자 옵션
5. "USB 디버깅" 켜기
6. USB 케이블로 컴퓨터 연결
7. "USB 디버깅 허용" 팝업에서 "허용" 탭
```

**기기 확인:**

```bash
Android Studio → Running Devices
또는
adb devices
```

**예상 출력:**
```
List of devices attached
XXXXXXXXXX      device
```

**체크포인트:**
- ☐ 기기가 인식되는가?
- ☐ "device" 상태인가? (unauthorized 아님)

**방법 2: Android Emulator**

```bash
1. Tools → Device Manager
2. "Create Device" 클릭
3. Pixel 6 선택 → Next
4. System Image: API 33 (Android 13) 다운로드 및 선택
5. Finish
6. ▶ 버튼으로 에뮬레이터 실행
```

**체크포인트:**
- ☐ 에뮬레이터가 실행되는가?
- ☐ 홈 화면이 표시되는가?

### 6.2 앱 설치 및 실행

**앱 실행:**

```bash
Run → Run 'app' (Shift+F10)
또는
상단 툴바의 녹색 ▶ 버튼 클릭
```

**디바이스 선택:**
```
Select Deployment Target
└─ [Connected Device]
   └─ Your Device Name
      [OK]
```

**설치 진행:**
```
Installing APK...
Uploading...
Success
Starting activity...
```

**예상 소요 시간**: 30초~2분

**체크포인트:**
- ☐ 앱이 자동으로 실행되는가?
- ☐ "물 섭취량 모니터" 화면이 보이는가?

### 6.3 권한 허용

**블루투스 권한 요청:**

앱 실행 시 권한 요청 팝업이 나타납니다.

**Android 12 이상:**
```
"Nearby devices" 권한 요청
[Allow] 버튼 탭
```

**Android 11 이하:**
```
"Bluetooth" 권한 요청
[Allow] 버튼 탭
```

**알림 권한 (Android 13 이상):**
```
"Notifications" 권한 요청 (나중에)
[Allow] 버튼 탭
```

**수동 권한 확인 (필요시):**

```bash
1. 휴대폰 설정 → 앱 → aduino1
2. 권한 탭
3. "Nearby devices" 또는 "Bluetooth" → "허용"
4. "Notifications" → "허용" (선택)
```

**체크포인트:**
- ☐ 블루투스 권한 허용됨
- ☐ 권한 거부 메시지 없음

### 6.4 초기 화면 확인

**홈 화면 구성:**

```
┌─────────────────────────────┐
│   물 섭취량 모니터           │
├─────────────────────────────┤
│ 블루투스 연결                │
│ 연결 상태: 연결 안 됨        │
│ [디바이스 연결]              │
├─────────────────────────────┤
│ 현재 무게                    │
│      0.0 g                   │
├─────────────────────────────┤
│ 오늘의 섭취량            [+] │
│ ░░░░░░░░░░ 0%                │
│ 0 / 2000 ml                  │
│ 목표까지 2000ml 남았습니다   │
└─────────────────────────────┘
```

**체크포인트:**
- ☐ 3개의 카드가 표시되는가?
- ☐ "디바이스 연결" 버튼이 있는가?
- ☐ 현재 무게가 0.0g인가?
- ☐ 오늘의 섭취량이 0ml인가?

---

## Step 7: 통합 테스트

### 7.1 블루투스 디바이스 연결

**사전 준비:**
- ☐ Arduino가 USB로 전원 공급 중
- ☐ HC-05/06이 켜져 있음 (LED 깜빡임)
- ☐ 휴대폰 블루투스 켜짐
- ☐ HC-05/06과 페어링 완료

**앱에서 연결:**

```bash
1. "디바이스 연결" 버튼 탭
2. 디바이스 목록에서 HC-05 또는 HC-06 선택
3. 연결 대기 (2-5초)
```

**예상 동작:**

1. 연결 중:
   ```
   연결 상태: 연결 중 (노란색)
   ```

2. 연결 성공:
   ```
   연결 상태: 연결됨 (파란색)
   연결됨: HC-05
   [연결 해제] [영점 조정]
   Snackbar: "HC-05에 연결되었습니다"
   ```

**체크포인트:**
- ☐ 연결 상태가 "연결됨"으로 변경되는가?
- ☐ 디바이스 이름이 표시되는가?
- ☐ 버튼이 "연결 해제", "영점 조정"으로 변경되는가?
- ☐ Snackbar 메시지가 나타나는가?

### 7.2 실시간 무게 표시 테스트

**테스트 1: 빈 로드셀**

```
동작: 로드셀 위에 아무것도 올리지 않음
예상 화면:
┌─────────────────────┐
│ 현재 무게           │
│      0.5 g          │  ← 실시간으로 변함
└─────────────────────┘
```

**체크포인트:**
- ☐ 무게가 실시간으로 업데이트되는가?
- ☐ 값이 0 근처인가? (±10g)

**테스트 2: 컵 올리기**

```
동작: 빈 컵을 로드셀에 올림
예상 화면:
┌─────────────────────┐
│ 현재 무게           │
│    120.5 g          │  ← 컵 무게
└─────────────────────┘
```

**체크포인트:**
- ☐ 무게가 즉시 변경되는가?
- ☐ 값이 안정적인가? (심하게 흔들리지 않음)

**테스트 3: 물 담기**

```
동작: 컵에 물을 부음
예상 화면:
┌─────────────────────┐
│ 현재 무게           │
│    370.2 g          │  ← 컵 + 물
└─────────────────────┘
```

**체크포인트:**
- ☐ 무게가 계속 업데이트되는가?
- ☐ 물을 붓는 동작이 반영되는가?

### 7.3 영점 조정 테스트

**테스트:**

```bash
1. 컵을 로드셀에서 제거
2. "영점 조정" 버튼 탭
3. 결과 확인
```

**예상 동작:**

1. Snackbar:
   ```
   "영점 조정 중..."
   ```

2. 무게 리셋:
   ```
   현재 무게: 0.0 g
   ```

**체크포인트:**
- ☐ Snackbar 메시지 표시
- ☐ 무게가 0으로 리셋
- ☐ 이후 측정이 정상 작동

### 7.4 자동 섭취 감지 테스트

**중요한 테스트!**

**테스트 시나리오:**

```bash
1. 컵에 물 200ml 담기
2. 로드셀에 올리기
3. 잠시 대기 (안정화)
4. 물 50ml 마시기
5. 컵을 다시 로드셀에 올리기
6. 앱 확인
```

**예상 동작:**

1. 물을 마시기 전:
   ```
   현재 무게: 320.5 g (컵 120g + 물 200g)
   오늘의 섭취량: 0 ml
   ```

2. 물을 마신 후:
   ```
   현재 무게: 270.2 g (컵 120g + 물 150g)

   Snackbar: "50ml 기록됨"

   오늘의 섭취량:
   ▓▓░░░░░░░░ 2%
   50 / 2000 ml
   목표까지 1950ml 남았습니다
   ```

**체크포인트:**
- ☐ 무게 감소가 감지되는가?
- ☐ Snackbar에 마신 양이 표시되는가?
- ☐ 오늘의 섭취량이 자동으로 증가하는가?
- ☐ 진행률 바가 업데이트되는가?
- ☐ 남은 양이 재계산되는가?

### 7.5 수동 기록 추가 테스트

**테스트:**

```bash
1. 오늘의 섭취량 카드의 [+] 버튼 탭
2. 다이얼로그에 "100" 입력
3. "추가" 버튼 탭
```

**예상 동작:**

1. 다이얼로그:
   ```
   ┌─────────────────────┐
   │ 물 섭취 기록 추가    │
   ├─────────────────────┤
   │ 양 (ml)             │
   │ [100        ]       │
   ├─────────────────────┤
   │ [취소]    [추가]    │
   └─────────────────────┘
   ```

2. 추가 후:
   ```
   Snackbar: "100ml 기록됨"

   오늘의 섭취량:
   ▓▓▓░░░░░░░ 7%
   150 / 2000 ml  (50 + 100)
   ```

**체크포인트:**
- ☐ 다이얼로그가 열리는가?
- ☐ 숫자 입력이 가능한가?
- ☐ 추가 버튼이 작동하는가?
- ☐ 기록이 반영되는가?
- ☐ 섭취량이 누적되는가?

### 7.6 연결 해제 테스트

**테스트:**

```bash
"연결 해제" 버튼 탭
```

**예상 동작:**

```
연결 상태: 연결 안 됨 (회색)
[디바이스 연결] 버튼만 표시
Snackbar: "연결이 해제되었습니다"
현재 무게: 0.0 g (업데이트 중지)
```

**체크포인트:**
- ☐ 연결이 해제되는가?
- ☐ 버튼이 "디바이스 연결"로 변경되는가?
- ☐ 무게 업데이트가 중지되는가?

### 7.7 앱 재시작 후 데이터 확인

**중요: 데이터 영구성 테스트**

**테스트:**

```bash
1. 앱 종료 (백 버튼 또는 홈 버튼)
2. 앱 재실행
3. 오늘의 섭취량 확인
```

**예상 결과:**

```
오늘의 섭취량:
▓▓▓░░░░░░░ 7%
150 / 2000 ml  ← 이전 데이터 유지!
```

**체크포인트:**
- ☐ 앱 재실행 후에도 데이터가 유지되는가?
- ☐ 섭취량이 0으로 리셋되지 않는가?

---

## Step 8: 실제 사용 시나리오 테스트

### 8.1 아침 루틴 시나리오

**시나리오:**

아침에 일어나서 물을 마시는 상황

**절차:**

```bash
1. 아두이노 전원 켜기 (USB 연결)
2. 앱 실행
3. 블루투스 연결
4. 빈 컵을 로드셀에 올리기
5. "영점 조정" 버튼 탭
6. 컵에 물 200ml 붓기
7. 물 마시기
8. 컵 다시 올리기
9. 기록 확인
```

**예상 결과:**

```
✓ 블루투스 연결 성공
✓ 영점 조정 완료
✓ 물을 마신 양(200ml) 자동 감지
✓ 오늘의 섭취량: 200 / 2000 ml (10%)
```

**체크포인트:**
- ☐ 모든 단계가 매끄럽게 진행되는가?
- ☐ 사용자 개입이 최소화되는가?
- ☐ 자동 감지가 정확한가?

### 8.2 하루 종일 사용 시나리오

**시나리오:**

하루 동안 여러 번 물을 마시는 상황

**절차:**

```bash
[09:00] 물 200ml 마심 → 자동 기록
[11:30] 물 150ml 마심 → 자동 기록
[14:00] 물 300ml 마심 → 자동 기록
[16:30] 물 250ml 마심 → 자동 기록
[19:00] 물 200ml 마심 → 자동 기록
[21:00] 물 150ml 마심 → 자동 기록
```

**예상 총계:**
```
1,250 / 2,000 ml (62%)
목표까지 750ml 남았습니다
```

**체크포인트:**
- ☐ 매번 자동으로 기록되는가?
- ☐ 누적 계산이 정확한가?
- ☐ 진행률이 실시간으로 업데이트되는가?

### 8.3 외출 후 복귀 시나리오

**시나리오:**

외출했다가 돌아와서 수동으로 기록 추가

**절차:**

```bash
1. 외출 전 앱 확인: 500 / 2000 ml
2. 외출 중 카페에서 물 300ml 마심 (앱 미사용)
3. 귀가 후 앱 실행
4. [+] 버튼으로 300ml 수동 추가
5. 결과 확인
```

**예상 결과:**

```
800 / 2000 ml (40%)
목표까지 1200ml 남았습니다
```

**체크포인트:**
- ☐ 수동 기록 추가가 간편한가?
- ☐ 자동 기록과 수동 기록이 잘 합산되는가?

### 8.4 목표 달성 시나리오

**시나리오:**

하루 목표(2000ml)를 달성하는 상황

**절차:**

```bash
현재: 1900 / 2000 ml
물 100ml 이상 마시기
```

**예상 결과:**

```
2000 / 2000 ml (100%)
오늘의 목표를 달성했습니다! ✓
```

**체크포인트:**
- ☐ 100% 달성 시 메시지가 변경되는가?
- ☐ 진행률 바가 가득 차는가?

### 8.5 스트레스 테스트

**테스트 1: 빠른 연속 측정**

```bash
동작: 컵을 빠르게 올렸다 내렸다 반복
예상: 시스템이 안정적으로 작동
```

**체크포인트:**
- ☐ 앱이 크래시하지 않는가?
- ☐ 무게 값이 안정적인가?
- ☐ 오검출이 없는가?

**테스트 2: 장시간 연결**

```bash
동작: 블루투스를 1시간 이상 연결 유지
예상: 연결이 끊기지 않음
```

**체크포인트:**
- ☐ 연결이 유지되는가?
- ☐ 데이터 전송이 계속되는가?

**테스트 3: 다량의 데이터**

```bash
동작: 하루에 20번 이상 기록
예상: 데이터베이스가 정상 작동
```

**체크포인트:**
- ☐ 모든 기록이 저장되는가?
- ☐ 앱 성능이 저하되지 않는가?

---

## 문제 해결

### HX711 오류

**증상:**
```
ERROR: HX711 not found!
```

**원인 및 해결:**

1. **연결 확인**
   - ☐ VCC → 5V 연결 확인
   - ☐ GND → GND 연결 확인
   - ☐ DT → Pin 3 연결 확인
   - ☐ SCK → Pin 2 연결 확인

2. **핀 번호 확인**
   ```cpp
   // config.h에서 확인
   #define HX711_DOUT_PIN  3  // 실제 연결과 일치?
   #define HX711_SCK_PIN   2  // 실제 연결과 일치?
   ```

3. **라이브러리 재설치**
   ```bash
   Sketch → Include Library → Manage Libraries
   HX711 삭제 후 재설치
   ```

4. **HX711 모듈 불량**
   - 다른 HX711 모듈로 교체 시도

### 블루투스 연결 오류

**증상 1: HC-05/06이 검색되지 않음**

**해결:**
- ☐ HC-05/06의 전원 확인 (LED 깜빡임)
- ☐ VCC 연결 확인
- ☐ 휴대폰 블루투스 켜짐 확인
- ☐ 다른 기기와 이미 연결되어 있는지 확인

**증상 2: 페어링 실패**

**해결:**
- ☐ PIN 1234 또는 0000 시도
- ☐ HC-05/06 리셋 (전원 껐다 켜기)
- ☐ 휴대폰 블루투스 껐다 켜기

**증상 3: 앱에서 연결 실패**

**해결:**
- ☐ 권한 확인 (설정 → 앱 → 권한)
- ☐ 페어링 상태 확인
- ☐ 다른 앱(터미널 앱)에서 연결 가능한지 확인
- ☐ 앱 재시작

**증상 4: 데이터 수신 안 됨**

**해결:**
- ☐ TX/RX 교차 연결 확인
- ☐ 전압 분배기 확인
- ☐ Baud rate 9600 확인
- ☐ 시리얼 모니터에서 데이터 전송 확인

### 무게 측정 오류

**증상 1: 무게가 매우 부정확함**

**해결:**
1. **캘리브레이션 재조정**
   ```bash
   1. 알려진 무게(1000g) 준비
   2. 시리얼 모니터에서 출력 값 확인
   3. CALIBRATION_FACTOR = 출력값 / 실제무게
   4. config.h 수정 및 재업로드
   ```

2. **로드셀 확인**
   - 4개 선이 모두 연결되어 있는가?
   - 선이 끊어지지 않았는가?

**증상 2: 무게가 불안정함 (계속 변함)**

**해결:**
```cpp
// config.h에서 조정
#define AVERAGE_SAMPLES   20  // 10에서 20으로 증가
#define STABLE_READINGS   10  // 5에서 10으로 증가
```

**증상 3: 무게가 음수로 표시됨**

**해결:**
```cpp
// config.h에서 부호 변경
#define CALIBRATION_FACTOR  7050.0  // 음수를 양수로
```

### 앱 크래시

**증상: 앱이 갑자기 종료됨**

**해결:**

1. **Logcat 확인**
   ```bash
   Android Studio → Logcat
   에러 메시지 확인
   ```

2. **권한 확인**
   - 설정 → 앱 → aduino1 → 권한
   - 모든 필요한 권한 허용

3. **앱 재설치**
   ```bash
   1. 앱 삭제
   2. Android Studio에서 재빌드
   3. 재설치
   ```

4. **캐시 삭제**
   ```bash
   설정 → 앱 → aduino1 → 저장공간 → 캐시 삭제
   ```

### 데이터 저장 안 됨

**증상: 앱 재시작 시 데이터 사라짐**

**해결:**

1. **Database Inspector 확인**
   ```bash
   Android Studio → View → Tool Windows → App Inspection
   Database → water_records 테이블 확인
   ```

2. **권한 확인**
   - 저장소 권한이 필요한 경우 확인

3. **로그 확인**
   ```bash
   Logcat에서 "Room" 또는 "Database" 검색
   ```

---

## 최종 체크리스트

### 하드웨어 체크리스트

- [ ] **로드셀 연결**
  - [ ] HX711에 올바르게 연결
  - [ ] 4개 선 모두 연결

- [ ] **HX711 연결**
  - [ ] Arduino에 올바르게 연결
  - [ ] VCC, GND, DT, SCK 확인

- [ ] **HC-05/06 연결**
  - [ ] 전압 분배기 사용
  - [ ] TX/RX 교차 연결
  - [ ] LED 깜빡임 확인

- [ ] **전원**
  - [ ] USB 연결
  - [ ] 모든 모듈 작동

### 아두이노 체크리스트

- [ ] **코드 업로드**
  - [ ] 컴파일 성공
  - [ ] 업로드 성공
  - [ ] 에러 없음

- [ ] **기능 테스트**
  - [ ] HX711 초기화 성공
  - [ ] 무게 측정 가능
  - [ ] 블루투스 전송 확인
  - [ ] 무게 변화 감지
  - [ ] 명령 처리 작동

### 블루투스 체크리스트

- [ ] **연결**
  - [ ] 페어링 성공
  - [ ] 터미널 연결 확인
  - [ ] 양방향 통신 확인

### 앱 체크리스트

- [ ] **빌드 및 설치**
  - [ ] Gradle Sync 성공
  - [ ] 빌드 성공
  - [ ] 설치 성공
  - [ ] 권한 허용

- [ ] **기능 테스트**
  - [ ] 블루투스 연결
  - [ ] 실시간 무게 표시
  - [ ] 자동 섭취 감지
  - [ ] 수동 기록 추가
  - [ ] 데이터 영구 저장
  - [ ] 진행률 표시

### 통합 테스트 체크리스트

- [ ] **연결**
  - [ ] 앱-Arduino 연결 성공
  - [ ] 데이터 수신 확인

- [ ] **자동 측정**
  - [ ] 무게 감소 자동 감지
  - [ ] 정확한 양 계산
  - [ ] 자동 기록 저장

- [ ] **사용자 인터페이스**
  - [ ] 직관적인 UI
  - [ ] 실시간 업데이트
  - [ ] 메시지 표시

- [ ] **데이터 관리**
  - [ ] 누적 계산 정확
  - [ ] 앱 재시작 후 유지
  - [ ] 날짜별 관리

---

## 성공 기준

### ✅ 시스템이 성공적으로 작동한다면:

1. **하드웨어**
   - Arduino에서 무게 측정 가능
   - 블루투스로 데이터 전송
   - 명령 수신 및 처리

2. **앱**
   - 블루투스 연결 성공
   - 실시간 무게 표시
   - 자동 섭취 감지 및 기록
   - 수동 기록 추가 가능
   - 데이터 영구 저장

3. **사용성**
   - 사용자 개입 최소화
   - 정확한 측정
   - 직관적인 인터페이스

---

## 다음 단계

### 시스템이 정상 작동한다면:

1. **캘리브레이션 정밀 조정**
   - 여러 무게로 테스트
   - CALIBRATION_FACTOR 최적화

2. **실제 사용 시작**
   - 컵 거치대 제작
   - 안정적인 위치 선택
   - 일상적으로 사용

3. **Phase 2 개발 고려**
   - 통계 화면
   - 알림 기능
   - 설정 화면

### 문제가 있다면:

1. **문제 해결 섹션 참조**
2. **로그 확인** (시리얼 모니터, Logcat)
3. **단계별 재확인**
4. **하드웨어 연결 재확인**

---

## 📞 추가 지원

### 참고 문서
- `arduino/README.md` - 아두이노 상세 가이드
- `app/README.md` - 앱 상세 가이드
- `README.md` - 프로젝트 전체 설명
- `WORK_LOG.md` - 작업 이력

### 디버깅 도구
- Arduino 시리얼 모니터
- Android Studio Logcat
- Database Inspector
- 블루투스 터미널 앱

---

**테스트 완료일**: ___________
**테스트 결과**: ☐ 성공 ☐ 부분 성공 ☐ 실패
**메모**: ___________________________________________

---

*이 가이드를 따라 모든 단계를 완료하면 물 섭취량 모니터링 시스템이 완벽하게 작동할 것입니다!*

**행운을 빕니다! 💧**